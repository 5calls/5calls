<div class="i-bar">
  <div class="i-bar-location" id="react-location">
    <div>
      <span>&nbsp;</span>
      <strong>&nbsp;</strong>
      <button class="button-link">&nbsp;</button>
    </div>
  </div>

  <div class="i-bar-list">
    <header class="i-bar-header i-bar-header-unsorted">
      <h3><i class="fa fa-newspaper"></i> {{ .Title }} Issues</h3>
    </header>
    <div id="react-search"></div>
    <section class="i-bar-list-section">

      <!-- Get the state name from the page title -->
      {{ $stateName := .Title }}
      {{ $passedIssueID := (.Scratch.Get "issueId")}}
      
      <!-- Filter issues that:
           1. Are NOT active (so they don't appear on main page)
           2. Are not hidden
           3. Contain the state name in their content or are specifically for that state
      -->
      {{ $stateIssues := slice }}
      {{ range where (where .Site.Pages "Type" "issue") "Params.hidden" false }}
        {{ $shouldInclude := false }}
        
        <!-- Check if issue mentions the state in content -->
        {{ if in .Content $stateName }}
          {{ $shouldInclude = true }}
        {{ end }}
        
        <!-- Check if issue mentions the state in title -->
        {{ if in .Title $stateName }}
          {{ $shouldInclude = true }}
        {{ end }}
        
        <!-- Check if it's an AttorneysGeneral issue (state-specific) -->
        {{ if in .Params.contactAreas "AttorneysGeneral" }}
          {{ $shouldInclude = true }}
        {{ end }}
        
        <!-- Only include if it's not already on the main page (not active) -->
        {{ if and $shouldInclude (not .Params.active) }}
          {{ $stateIssues = $stateIssues | append . }}
        {{ end }}
      {{ end }}
      
      <!-- Sort by order parameter -->
      {{ range sort $stateIssues ".Params.order" }}
      <a
        class="i-bar-item is-unsorted{{ if eq $passedIssueID .Params.issueId }} is-active{{ end }}"
        href="{{ .Permalink }}"
      >
        <div class="i-bar-item-check">
          <div class="i-bar-check-completed" data-issue-id="{{ .Params.issueId }}">
            <i class="fa fa-phone"></i>
            <span class="sr-only">Needs your calls</span>
          </div>
        </div>
        <strong>{{ .Title }}</strong>
      </a>
      {{ end }}
    </section>
  </div>

  <a href="/all/" class="i-bar-more"><i class="fa-solid fa-table-list"></i>&nbsp;&nbsp;See all {{ len (where (where .Site.Pages "Type" "issue") "Params.hidden" false) }} issues</a>
</div>
<div class="i-hidden-bar">
   <a href="/" class="i-bar-top-issues"> <i class="fa-solid fa-circle-left"></i>&nbsp;&nbsp;Back to top issues</a>
</div>